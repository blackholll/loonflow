# 流程图编辑器

这是一个基于 React Flow 的流程图编辑器组件，提供了完整的流程图设计和编辑功能。

## 功能特性

### 节点类型
- **基础节点**
  - 开始节点：流程的起始点，绿色椭圆形
  - 普通节点：处理节点，蓝色矩形
  - 结束节点：流程的结束点，红色椭圆形

- **网关节点**
  - 并行网关：支持多个分支并行执行，橙色菱形
  - 排他网关：支持条件分支选择，紫色菱形

### 工具栏功能
- **清空**：清空整个画布
- **撤销**：撤销上一步操作
- **重做**：重做上一步操作
- **删除**：删除选中的节点或连线
- **复制**：复制选中的节点或连线

### 属性面板
- **节点属性**：编辑节点的名称、描述、处理人、超时时间等
- **连线属性**：编辑连线的名称、描述、类型、条件表达式等
- **特定配置**：根据节点类型显示不同的配置选项

## 使用方法

### 1. 访问编辑器
在浏览器中访问 `/flow-editor` 路径即可打开流程图编辑器。

### 2. 添加节点
1. 在左侧节点面板中选择要添加的节点类型
2. 点击节点类型即可在画布中添加节点
3. 节点会自动添加到画布中心位置

### 3. 连接节点
1. 从一个节点的连接点（小圆点）拖拽到另一个节点的连接点
2. 不同类型的节点有不同的连接点位置：
   - 开始节点：只有底部输出连接点
   - 普通节点：顶部输入连接点，底部输出连接点
   - 结束节点：只有顶部输入连接点
   - 网关节点：顶部输入连接点，底部、左侧、右侧输出连接点

### 4. 编辑属性
1. 点击节点或连线选中它们
2. 右侧属性面板会自动打开
3. 在属性面板中编辑相应的属性
4. 属性会实时保存

### 5. 删除元素
1. 选中要删除的节点或连线
2. 点击顶部工具栏的删除按钮
3. 或者直接按键盘的 Delete 键

## 技术实现

### 主要组件
- `FlowEditor`：主编辑器组件
- `NodePanel`：左侧节点面板
- `Toolbar`：顶部工具栏
- `PropertyPanel`：右侧属性面板
- `CustomNode`：自定义节点组件
- `CustomEdge`：自定义连线组件

### 依赖库
- `@xyflow/react`：React Flow 流程图库
- `@mui/material`：Material-UI 组件库
- `@mui/icons-material`：Material-UI 图标库

### 状态管理
- 使用 React 的 `useState` 和 `useCallback` 管理组件状态
- 节点和连线的状态通过 React Flow 的 hooks 管理

## 扩展功能

### 添加新的节点类型
1. 在 `NodePanel.tsx` 中的 `nodeConfigs` 对象中添加新节点配置
2. 在 `CustomNode.tsx` 中添加对应的图标和样式
3. 在 `PropertyPanel.tsx` 中添加对应的属性编辑界面

### 添加新的连线类型
1. 在 `CustomEdge.tsx` 中添加新的连线样式
2. 在 `PropertyPanel.tsx` 中添加对应的属性编辑界面

### 实现撤销/重做功能
1. 使用历史记录数组保存操作历史
2. 在每次操作时保存当前状态
3. 实现撤销和重做的逻辑

### 实现复制功能
1. 复制选中的节点或连线数据
2. 在画布中创建副本
3. 调整副本的位置避免重叠

## 注意事项

1. 确保浏览器支持现代 JavaScript 特性
2. 建议使用 Chrome、Firefox、Safari 等现代浏览器
3. 画布支持缩放和平移操作
4. 节点可以自由拖拽移动
5. 连线会自动跟随节点移动

## 开发环境

```bash
# 安装依赖
npm install

# 启动开发服务器
npm start

# 访问流程图编辑器
http://localhost:3000/flow-editor
```

# 工作流设计器 - 四连接点系统

## 节点样式

### 矩形节点布局
- **尺寸**：200x60像素
- **背景**：透明背景，灰色边框
- **布局**：左侧图标区域 + 右侧名称区域
- **编辑功能**：双击节点名称可编辑

### 节点结构
1. **左侧图标区域（60px宽）**
   - 显示节点类型图标
   - 不同节点类型使用不同颜色图标
   - 与名称区域有分隔线

2. **右侧名称区域（140px宽）**
   - 显示节点名称
   - 支持双击编辑
   - 支持回车确认或失焦保存

### 节点类型和颜色
- **开始节点**：绿色图标 (#4caf50) + 播放图标
- **结束节点**：红色图标 (#f44336) + 停止图标
- **普通节点**：蓝色图标 (#2196f3) + 圆形图标
- **并行网关**：橙色图标 (#ff9800) + 树形图标
- **排他网关**：紫色图标 (#9c27b0) + 分支图标

### 节点交互
- **悬停**：边框变为蓝色，显示连接点
- **选中**：蓝色边框高亮
- **编辑**：双击名称进入编辑模式

## 连接点说明

### 连接点显示逻辑
- **默认状态**：连接点不显示
- **悬停显示**：鼠标移动到节点上时显示所有连接点
- **离开隐藏**：鼠标离开节点时隐藏连接点

### 连接点位置和功能

每个位置有一个连接点，可以同时作为输入和输出：

1. **顶部连接点（绿色）**
   - 位置：节点顶部
   - 功能：既可以作为输出点发送连线，也可以作为输入点接收连线
   - 颜色：绿色 (#4caf50)

2. **底部连接点（红色）**
   - 位置：节点底部
   - 功能：既可以作为输出点发送连线，也可以作为输入点接收连线
   - 颜色：红色 (#ff5722)

3. **左侧连接点（橙色）**
   - 位置：节点左侧
   - 功能：既可以作为输出点发送连线，也可以作为输入点接收连线
   - 颜色：橙色 (#ff9800)

4. **右侧连接点（紫色）**
   - 位置：节点右侧
   - 功能：既可以作为输出点发送连线，也可以作为输入点接收连线
   - 颜色：紫色 (#9c27b0)

### 连接点特性
- **无浮动效果**：连接点不随选中状态变化
- **固定尺寸**：12x12像素
- **白色边框**：确保在任何背景下都清晰可见
- **唯一ID**：每个连接点都有唯一的标识符
- **双向功能**：所有连接点都可以作为输入和输出

## 连线样式

### 自动避让连线
- **类型**：平滑阶梯路径，自动避让障碍物
- **算法**：使用`getSmoothStepPath`函数
- **特性**：自动绕过节点和其他连线
- **箭头**：连线末端有方向箭头
- **样式**：选中时加粗并高亮
- **标签**：支持显示连线标签

### 连线特性
- 智能避让算法，自动绕过障碍物
- 平滑的阶梯路径，避免直线穿过节点
- 自动箭头指示方向
- 选中状态高亮显示
- 支持标签显示和编辑

## 使用方法

1. **创建连线**：
   - 鼠标悬停在节点上显示连接点
   - 从任意输出连接点拖拽到任意输入连接点
   - 支持同节点连接（节点内部连线）
   - 支持多连线（两个节点间多条连线）

2. **编辑节点名称**：
   - 双击节点名称进入编辑模式
   - 输入新名称后按回车或点击其他地方保存
   - 支持中文和英文名称

3. **连接规则**：
   - 允许所有类型的连接
   - 支持同节点连接
   - 支持多连线连接
   - 支持任意连接点组合

4. **视觉反馈**：
   - 悬停时显示连接点
   - 选中时连接点保持显示
   - 不同颜色的连接点便于识别
   - 节点选中时有蓝色边框
   - 连线自动避让，路径清晰

## 技术特性

- 每个连接点都有唯一的ID
- 支持连接点级别的连线管理
- 连线ID包含源连接点和目标连接点信息
- 响应式设计，适配不同屏幕尺寸
- 透明节点背景，简洁美观
- 智能连线避让，路径清晰
- 平滑阶梯路径算法
- 条件显示连接点，界面简洁

## 注意事项

- 所有节点类型都使用相同的透明背景布局
- 连接点只在悬停时显示，保持界面简洁
- 支持同节点连接和多连线连接
- 连线使用智能避让算法，自动绕过障碍物
- 支持连线的选择和删除操作
- 节点名称支持实时编辑
- 透明背景提供更好的视觉层次 